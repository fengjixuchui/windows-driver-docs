---
title: Retrieving COPP-Compatible Information about a Protected Output
description: Retrieving COPP-Compatible Information about a Protected Output
ms.assetid: 9114f232-4123-47a8-b43d-62d14b9f6b08
keywords:
- OPM WDK display , retrieving COPP-compatible information
ms.date: 04/20/2017
ms.localizationpriority: medium
---

# Retrieving COPP-Compatible Information about a Protected Output


The display miniport driver can receive requests to retrieve COPP-compatible information about the protected output that is associated with a graphics adapter's physical output connector. The display miniport driver's [**DxgkDdiOPMGetCOPPCompatibleInformation**](https://msdn.microsoft.com/library/windows/hardware/ff559720) function is passed a pointer to a [**DXGKMDT\_OPM\_COPP\_COMPATIBLE\_GET\_INFO\_PARAMETERS**](https://msdn.microsoft.com/library/windows/hardware/ff560859) structure in the *Parameters* parameter that contains the information request. *DxgkDdiOPMGetCOPPCompatibleInformation* writes the required information to the [**DXGKMDT\_OPM\_REQUESTED\_INFORMATION**](https://msdn.microsoft.com/library/windows/hardware/ff560910) structure that the *RequestedInformation* parameter points to. The **guidInformation** and **abParameters** members of DXGKMDT\_OPM\_COPP\_COMPATIBLE\_GET\_INFO\_PARAMETERS specify the information request. Depending on the information request, the display miniport driver should populate the members of the [**DXGKMDT\_OPM\_STANDARD\_INFORMATION**](https://msdn.microsoft.com/library/windows/hardware/ff560925), [**DXGKMDT\_OPM\_ACTUAL\_OUTPUT\_FORMAT**](https://msdn.microsoft.com/library/windows/hardware/ff560840), [**DXGKMDT\_OPM\_ACP\_AND\_CGMSA\_SIGNALING**](https://msdn.microsoft.com/library/windows/hardware/ff560830), or [**DXGKMDT\_OPM\_CONNECTED\_HDCP\_DEVICE\_INFORMATION**](https://msdn.microsoft.com/library/windows/hardware/ff560854) structure with the required information and point the **abRequestedInformation** member of DXGKMDT\_OPM\_REQUESTED\_INFORMATION to that structure. After the driver specifies the **cbRequestedInformationSize** (for example, <strong>sizeof (</strong>DXGKMDT\_OPM\_STANDARD\_INFORMATION<strong>)</strong>) and **abRequestedInformation** members of DXGKMDT\_OPM\_REQUESTED\_INFORMATION, the driver must calculate the One-key Cipher Block Chaining (CBC)-mode message authentication code (OMAC) for the data in DXGKMDT\_OPM\_REQUESTED\_INFORMATION and must set this OMAC in the **omac** member of DXGKMDT\_OPM\_REQUESTED\_INFORMATION. For more information about calculating OMAC, see the [OMAC-1 algorithm](http://go.microsoft.com/fwlink/p/?linkid=70417).

**Note**   Before [**DxgkDdiOPMGetCOPPCompatibleInformation**](https://msdn.microsoft.com/library/windows/hardware/ff559720) returns, the display miniport driver must verify that the sequence number that is specified in the **ulSequenceNumber** member of DXGKMDT\_OPM\_COPP\_COMPATIBLE\_GET\_INFO\_PARAMETERS matches the sequence number that the driver currently has stored. The driver must then increment the stored sequence number.

 

**Note**   The driver must return a 128-bit cryptographically secure random number in the **rnRandomNumber** member of DXGKMDT\_OPM\_STANDARD\_INFORMATION, DXGKMDT\_OPM\_ACTUAL\_OUTPUT\_FORMAT, DXGKMDT\_OPM\_ACP\_AND\_CGMSA\_SIGNALING, or DXGKMDT\_OPM\_CONNECTED\_HDCP\_DEVICE\_INFORMATION. The random number was generated by the sending application and was provided in the **rnRandomNumber** member of DXGKMDT\_OPM\_COPP\_COMPATIBLE\_GET\_INFO\_PARAMETERS.

 

The driver returns the following information for the indicated request:

-   For DXGKMDT\_OPM\_GET\_SUPPORTED\_PROTECTION\_TYPES set in the **guidInformation** member and undefined in the **abParameters** member of DXGKMDT\_OPM\_COPP\_COMPATIBLE\_GET\_INFO\_PARAMETERS, the driver indicates the available types of protection mechanisms. To indicate the available protection types, the driver returns a valid bitwise OR combination of values from the [**DXGKMDT\_OPM\_PROTECTION\_TYPE**](https://msdn.microsoft.com/library/windows/hardware/ff560898) enumeration in the **ulInformation** member of DXGKMDT\_OPM\_STANDARD\_INFORMATION. The DXGKMDT\_OPM\_PROTECTION\_TYPE\_ACP, DXGKMDT\_OPM\_PROTECTION\_TYPE\_CGMSA, and DXGKMDT\_OPM\_PROTECTION\_TYPE\_COPP\_COMPATIBLE\_HDCP values are valid.

-   For DXGKMDT\_OPM\_GET\_CONNECTOR\_TYPE set in **guidInformation** and undefined in **abParameters**, the driver indicates the connector type. To indicate the connector type, the driver returns a valid bitwise OR combination of values from the [**D3DKMDT\_VIDEO\_OUTPUT\_TECHNOLOGY**](https://msdn.microsoft.com/library/windows/hardware/ff546605) enumeration in the **ulInformation** member of DXGKMDT\_OPM\_STANDARD\_INFORMATION.

-   For DXGKMDT\_OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL or DXGKMDT\_OPM\_GET\_ACTUAL\_PROTECTION\_LEVEL set in **guidInformation** and the protection type set in **abParameters**, the driver returns a protection-level value in the **ulInformation** member of [**DXGKMDT\_OPM\_STANDARD\_INFORMATION**](https://msdn.microsoft.com/library/windows/hardware/ff560925). If the protection type is DXGKMDT\_OPM\_PROTECTION\_TYPE\_ACP, the protection-level value is from the [**DXGKMDT\_OPM\_ACP\_PROTECTION\_LEVEL**](https://msdn.microsoft.com/library/windows/hardware/ff560834) enumeration. If the protection type is DXGKMDT\_OPM\_PROTECTION\_TYPE\_CGMSA, the protection-level value is from the [**DXGKMDT\_OPM\_CGMSA**](https://msdn.microsoft.com/library/windows/hardware/ff560846) enumeration. If the protection type is DXGKMDT\_OPM\_PROTECTION\_TYPE\_COPP\_COMPATIBLE\_HDCP, the protection-level value is from the [**DXGKMDT\_OPM\_HDCP\_PROTECTION\_LEVEL**](https://msdn.microsoft.com/library/windows/hardware/ff560878) enumeration.

    The DXGKMDT\_OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL request returns the currently set protection level for the protected output. The DXGKMDT\_OPM\_GET\_ACTUAL\_PROTECTION\_LEVEL request returns the currently set protection level for the physical connector that is associated with the protected output.

-   For DXGKMDT\_OPM\_GET\_ADAPTER\_BUS\_TYPE set in **guidInformation** and undefined in **abParameters**, the driver identifies the type of the bus that connects a graphics adapter to a mother board chipset's north bridge. To identify the type of the bus, the driver returns a valid bitwise OR combination of values from the [**DXGKMDT\_OPM\_BUS\_TYPE\_AND\_IMPLEMENTATION**](https://msdn.microsoft.com/library/windows/hardware/ff560841) enumeration in the **ulInformation** member of DXGKMDT\_OPM\_STANDARD\_INFORMATION.

    The driver can only combine the DXGKMDT\_OPM\_COPP\_COMPATIBLE\_BUS\_TYPE\_INTEGRATED (0x80000000) value with one of the bus-type values when none of the interface signals between the graphics adapter and other subsystems are available on an expansion bus that uses a publicly available specification and standard connector type. Memory buses are excluded from this definition.

-   For DXGKMDT\_OPM\_GET\_ACTUAL\_OUTPUT\_FORMAT set in **guidInformation** and undefined in **abParameters**, the driver returns information in the members of [**DXGKMDT\_OPM\_ACTUAL\_OUTPUT\_FORMAT**](https://msdn.microsoft.com/library/windows/hardware/ff560840) that describe how the signal that goes through the physical connector that is associated with the protected output is formatted.

-   For DXGKMDT\_OPM\_GET\_ACP\_AND\_CGMSA\_SIGNALING set in **guidInformation** and undefined in **abParameters**, the driver returns information in the members of [**DXGKMDT\_OPM\_ACP\_AND\_CGMSA\_SIGNALING**](https://msdn.microsoft.com/library/windows/hardware/ff560830) that describe how the signal that goes through the physical connector that is associated with the protected output is protected.

-   For DXGKMDT\_OPM\_GET\_CONNECTED\_HDCP\_DEVICE\_INFORMATION set in **guidInformation** and undefined in **abParameters**, the driver returns information in the members of [**DXGKMDT\_OPM\_CONNECTED\_HDCP\_DEVICE\_INFORMATION**](https://msdn.microsoft.com/library/windows/hardware/ff560854) that contain High-bandwidth Digital Content Protection (HDCP) information.

 

 





